<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sist.web.dao.BoardDao">

<!-- ################################################################################################## -->   
<!-- ################################################################################################## -->   
   <!-- NOTICE(공지사항) 게시판 리스트 resultMap -->
   <resultMap type="com.sist.web.model.BoardNotice" id="BoardNoticeResultMap">
   
      <id column="BRD_SEQ" property="brdSeq" />
      <result column="BRD_TITLE" property="brdTitle" />
      <result column="BRD_CONTENT" property="brdContent" />
      <result column="BRD_READ_CNT" property="brdReadCnt" />
      <result column="REG_DATE" property="regDate" />
      <result column="MOD_DATE" property="modDate" />
      <result column="DEL_DATE" property="delDate" />
      <result column="USER_ID" property="userId" />
      <result column="IS_MUST" property="isMust" />
      <result column="FILE_ORG_NAME" property="fileOrgName" />
      <result column="FILE_NAME" property="fileName" />
             
   </resultMap>
   
   <!-- NOTICE(공지사항) 첨부파일 resultMap -->
   <resultMap type="com.sist.web.model.BoardNoticeFile" id="BoardNoticeFileResultMap">
      <id column="FILE_SEQ" property="fileSeq" />
      <id column="BRD_SEQ" property="brdSeq" />
      <result column="FILE_NAME" property="fileName" />
      <result column="FILE_ORG_NAME" property="fileOrgName" />
      <result column="FILE_EXT" property="fileExt" />
      <result column="FILE_SIZE" property="fileSize" />
      <result column="REG_DATE" property="regDate" />
   </resultMap>
<!-- ################################################################################################## -->   
<!-- ################################################################################################## -->   
   
<!-- ################################################################################################## -->   
<!-- ################################################################################################## -->   
   <!-- QNA(문의사항) 게시판 리스트 resultMap -->
   <resultMap type="com.sist.web.model.BoardQna" id="BoardQnaResultMap">
   
      <id column="BRD_SEQ" property="brdSeq" />
      <result column="BRD_TITLE" property="brdTitle" />
      <result column="BRD_CONTENT" property="brdContent" />
      <result column="BRD_READ_CNT" property="brdReadCnt" />
      <result column="BRD_PARENT" property="brdParent" />
      <result column="REG_DATE" property="regDate" />
      <result column="MOD_DATE" property="modDate" />
      <result column="DEL_DATE" property="delDate" />
      <result column="USER_NAME" property="userName" />
      <result column="USER_EMAIL" property="userEmail" />
      <result column="BRD_PWD" property="brdPwd" />
      <result column="USER_ID" property="userId" />
      <result column="FILE_ORG_NAME" property="fileOrgName" />
      <result column="FILE_NAME" property="fileName" />
             
   </resultMap>
   
   <!-- QNA(문의사항) 첨부파일 resultMap -->
   <resultMap type="com.sist.web.model.BoardQnaFile" id="BoardQnaFileResultMap">
      <id column="FILE_SEQ" property="fileSeq" />
      <id column="BRD_SEQ" property="brdSeq" />
      <result column="FILE_NAME" property="fileName" />
      <result column="FILE_ORG_NAME" property="fileOrgName" />
      <result column="FILE_EXT" property="fileExt" />
      <result column="FILE_SIZE" property="fileSize" />
      <result column="REG_DATE" property="regDate" />
   </resultMap>
<!-- ################################################################################################## -->   
<!-- ################################################################################################## -->


<!-- ################################################################################################## -->   
<!-- ################################################################################################## -->

   <!-- 일반회원 resultMap -->
      <resultMap type="com.sist.web.model.User" id="userResultMap">
         <id column="USER_ID" property="userId" />
         <result column="USER_PWD" property="userPwd" />
         <result column="USER_EMAIL" property="userEmail" />
         <result column="USER_NAME" property="userName" />
         <result column="USER_PHONE" property="userPhone" />
         <result column="ADDR_CODE" property="addrCode" />
         <result column="ADDR_BASE" property="addrBase" />
         <result column="ADDR_DETAIL" property="addrDetail" />
         <result column="STATUS" property="status" />
         <result column="RATING" property="rating" />
         <result column="REG_DATE" property="regDate" />
         <result column="USER_PROFILE" property="userProfile" />
      </resultMap>
      
      <!-- 강사 resultMap -->
      <resultMap type="com.sist.web.model.Teacher" id="teacherResultMap">
         <id column="USER_ID" property="userId" />
         <result column="USER_PWD" property="userPwd" />
         <result column="USER_EMAIL" property="userEmail" />
         <result column="USER_NAME" property="userName" />
         <result column="USER_PHONE" property="userPhone" />
         <result column="ADDR_CODE" property="addrCode" />
         <result column="ADDR_BASE" property="addrBase" />
         <result column="ADDR_DETAIL" property="addrDetail" />
         <result column="STATUS" property="status" />
         <result column="RATING" property="rating" />
         <result column="REG_DATE" property="regDate" />
         <result column="USER_PROFILE" property="userProfile" />
         <result column="USER_INTRO" property="userIntro" />
         <result column="USER_DEGREE" property="userDegree" />
         <result column="USER_CAREER" property="userCareer" />
         <result column="CLASS_CODE" property="classCode" />
      </resultMap>
      
      <!-- 자유게시판 -->
      <resultMap type="com.sist.web.model.Board" id="boardResultMap">
         <id column="BRD_SEQ" property="brdSeq" />
         <id column="USER_ID" property="userId" />
         <result column="USER_NAME" property="userName" />
         <result column="BRD_TITLE" property="brdTitle" />
         <result column="BRD_CONTENT" property="brdContent" />
         <result column="BRD_READ_CNT" property="brdReadCnt" />
         <result column="BRD_SECRET" property="brdSecret" />
         <result column="REG_DATE" property="regDate" />
         <result column="MOD_DATE" property="modDate" />
         <result column="DEL_DATE" property="delDate" />
         <result column="CATEGORY" property="category" />
         <result column="USER_PROFILE" property="userProfile" />
      </resultMap>
      
      <!-- 좋아요 -->
       <resultMap type="com.sist.web.model.BoardLike" id="boardLikeResultMap">
          <result column="BRD_SEQ" property="brdSeq"/>
           <result column="USER_ID" property="userId"/>
       </resultMap>
       
      <!-- 북마크 -->
       <resultMap type="com.sist.web.model.BoardMark" id="boardMarkResultMap">
          <result column="BRD_SEQ" property="brdSeq"/>
           <result column="USER_ID" property="userId"/>
       </resultMap>
       
       <!-- 뎃글 -->
       <resultMap type="com.sist.web.model.Comment" id="commentResultMap">
          <result column="COM_SEQ" property="comSeq"/>
          <result column="BRD_SEQ" property="brdSeq"/>
          <result column="USER_ID" property="userId"/>
          <result column="COM_CONTENT" property="comContent"/>
          <result column="COM_PARENT" property="comParent"/>
          <result column="COM_GROUP" property="comGroup"/>
          <result column="COM_ORDER" property="comOrder"/>
          <result column="COM_INDENT" property="comIndent"/>
          <result column="COM_SECRET" property="comSecret"/>
          <result column="REG_DATE" property="regDate"/>
          <result column="MOD_DATE" property="modDate"/>
          <result column="DEL_DATE" property="delDate"/>
       </resultMap>
       
       <!-- 첨부파일 resultMap -->
       <resultMap type="com.sist.web.model.BoardFile" id="boardFileResultMap">
           <id column="BRD_SEQ" property="brdSeq"/>
           <id column="FILE_SEQ" property="fileSeq"/>
           <result column="FILE_ORG_NAME" property="fileOrgName"/>
           <result column="FILE_NAME" property="fileName"/>
           <result column="FILE_EXT" property="fileExt"/>
           <result column="FILE_SIZE" property="fileSize"/>
           <result column="REG_DATE" property="regDate"/>
       </resultMap>

<!-- ################################################################################################## -->   
<!-- ################################################################################################## -->
   
   
   
   
   
   
   
                  <!-- ###################################################### -->
         <!-- ################################################################################ -->   
<!-- ###########################################공지사항(시작)############################################# -->

   <!-- NOTICE(공지사항) 게시물 등록 -->
   <insert id="noticeBoardInsert" parameterType="com.sist.web.model.BoardNotice">
      <!-- 선행처리기(시퀀스조회) -->
      <selectKey resultType="long" keyProperty="brdSeq" order="BEFORE">
         SELECT SEQ_BOARD_NOTICE_SEQ.NEXTVAL FROM DUAL
      </selectKey>
      
      INSERT INTO EDU_NOTICE (
            BRD_SEQ,
             BRD_TITLE,
             BRD_CONTENT,
             BRD_READ_CNT,
             REG_DATE,
             MOD_DATE,
             USER_ID,
             IS_MUST
      ) VALUES (
          #{brdSeq},
          #{brdTitle},
          #{brdContent},
          0,
          SYSDATE,
          SYSDATE,
          #{userId},
          #{isMust}
      )
   
   </insert>
   
   <!-- NOTICE(공지사항) 첨부파일 등록 -->
   <insert id="noticeBoardFileInsert" parameterType="com.sist.web.model.BoardNoticeFile">
      INSERT INTO EDU_NOTICE_FILE (
          FILE_SEQ,
          BRD_SEQ,
          FILE_NAME,
          FILE_ORG_NAME,
          FILE_EXT,
          FILE_SIZE,
          REG_DATE
      ) VALUES (
          #{fileSeq},
          #{brdSeq},
          #{fileName},
          #{fileOrgName},
          #{fileExt},
          #{fileSize},
          SYSDATE
      )
   </insert>
   
   <!-- NOTICE(공지사항) 첨부파일 조회 -->
   <select id="noticeBoardFileSelect" parameterType="long" resultMap="BoardNoticeFileResultMap">
      SELECT FILE_SEQ,
             BRD_SEQ,
             NVL(FILE_NAME, '') FILE_NAME,
             NVL(FILE_ORG_NAME, '') FILE_ORG_NAME,
             NVL(FILE_EXT, '') FILE_EXT,
             NVL(FILE_SIZE, 0) FILE_SIZE,
             NVL(TO_CHAR(REG_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') REG_DATE
      FROM EDU_NOTICE_FILE
      WHERE BRD_SEQ = #{value}
        AND FILE_SEQ = 1
   </select>
   
   <delete id="noticeBoardFileDelete" parameterType="long">
      DELETE FROM EDU_NOTICE_FILE
       WHERE BRD_SEQ = #{value}
   </delete>
   
   <!-- NOTICE(공지사항) 필수 공지사항만 조회하는 쿼리 -->
   <select id="noticeBoardListByIsMust" parameterType="map" resultMap="BoardNoticeResultMap">
       SELECT BRD_SEQ,
              BRD_TITLE,
              BRD_CONTENT,
              BRD_READ_CNT,
              NVL(TO_CHAR(REG_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') REG_DATE,
              NVL(TO_CHAR(MOD_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') MOD_DATE,
              DEL_DATE,
              USER_ID,
              IS_MUST
         FROM EDU_NOTICE
        WHERE IS_MUST = #{isMust}
        
          <if test="search.searchType != null and search.searchValue != null">
              <choose>
                  <when test="search.searchType == '1'">
                      AND BRD_TITLE LIKE '%' || #{search.searchValue} || '%'
                  </when>
                  <when test="search.searchType == '2'">
                      AND BRD_CONTENT LIKE '%' || #{search.searchValue} || '%'
                  </when>
              </choose>
          </if>
          ORDER BY MOD_DATE DESC 
   </select>


   
   
   <!-- NOTICE(공지사항) 삭제되지 않은 글 게시글 리스트 -->
   <select id="noticeBoardList" parameterType="com.sist.web.model.BoardNotice" resultMap="BoardNoticeResultMap">

      SELECT BRD_SEQ,
             BRD_TITLE,
             BRD_CONTENT,
             BRD_READ_CNT,
             REG_DATE,
             MOD_DATE,
             DEL_DATE,
             USER_ID,
             IS_MUST
        FROM (SELECT ROWNUM AS RNUM,
                     BRD_SEQ,
                   BRD_TITLE,
                   BRD_CONTENT,
                   BRD_READ_CNT,
                   REG_DATE,
                   MOD_DATE,
                   DEL_DATE,
                   USER_ID,
                   IS_MUST
                FROM (SELECT A.BRD_SEQ,
                             B.USER_ID,
                             NVL(A.BRD_TITLE, '') BRD_TITLE,
                             NVL(A.BRD_CONTENT, '') BRD_CONTENT,
                             NVL(A.BRD_READ_CNT, '') BRD_READ_CNT,
                             NVL(TO_CHAR(A.REG_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') REG_DATE,
                             NVL(TO_CHAR(A.MOD_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') MOD_DATE,
                             NVL(TO_CHAR(A.DEL_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') DEL_DATE,
                             NVL(A.IS_MUST, 'N') IS_MUST
                        FROM EDU_NOTICE A, EDU_ADMIN B
                       WHERE A.USER_ID = B.USER_ID
                         AND A.DEL_DATE IS NULL
                         
            <if test='searchType != null and searchType != "" and searchValue != null and searchValue != ""'>                         
               
               <choose>
               
                  <when test='searchType == "1"'>
                          AND A.BRD_TITLE LIKE '%' || #{searchValue} || '%'
                      </when>
                      
                      <when test='searchType == "2"'>
                          AND A.BRD_CONTENT LIKE '%' || #{searchValue} || '%'
                      </when>
                     
                  </choose>    
            
            </if>
              
                      ORDER BY A.BRD_SEQ DESC))
       WHERE RNUM <![CDATA[>=]]> #{startRow}
         AND RNUM <![CDATA[<=]]> #{endRow}

   
   </select>
   
   <!-- NOTICE(공지사항) 삭제된 글 게시글 리스트 -->
   <select id="noticeDelBoardList" parameterType="com.sist.web.model.BoardNotice" resultMap="BoardNoticeResultMap">

      SELECT BRD_SEQ,
             BRD_TITLE,
             BRD_CONTENT,
             BRD_READ_CNT,
             REG_DATE,
             MOD_DATE,
             DEL_DATE,
             USER_ID,
             IS_MUST
        FROM (SELECT ROWNUM AS RNUM,
                     BRD_SEQ,
                   BRD_TITLE,
                   BRD_CONTENT,
                   BRD_READ_CNT,
                   REG_DATE,
                   MOD_DATE,
                   DEL_DATE,
                   USER_ID,
                   IS_MUST
                FROM (SELECT A.BRD_SEQ,
                             B.USER_ID,
                             NVL(A.BRD_TITLE, '') BRD_TITLE,
                             NVL(A.BRD_CONTENT, '') BRD_CONTENT,
                             NVL(A.BRD_READ_CNT, '') BRD_READ_CNT,
                             NVL(TO_CHAR(A.REG_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') REG_DATE,
                             NVL(TO_CHAR(A.MOD_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') MOD_DATE,
                             NVL(TO_CHAR(A.DEL_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') DEL_DATE,
                             NVL(A.IS_MUST, 'N') IS_MUST
                        FROM EDU_NOTICE A, EDU_ADMIN B
                       WHERE A.USER_ID = B.USER_ID
                         AND A.DEL_DATE IS NOT NULL
                         
            <if test='searchType != null and searchType != "" and searchValue != null and searchValue != ""'>                         
               
               <choose>
               
                  <when test='searchType == "1"'>
                          AND A.BRD_TITLE LIKE '%' || #{searchValue} || '%'
                      </when>
                      
                      <when test='searchType == "2"'>
                          AND A.BRD_CONTENT LIKE '%' || #{searchValue} || '%'
                      </when>
                     
                  </choose>    
            
            </if>
              
                      ORDER BY A.BRD_SEQ DESC))
       WHERE RNUM <![CDATA[>=]]> #{startRow}
         AND RNUM <![CDATA[<=]]> #{endRow}

   
   </select>
   
   <!-- NOTICE(공지사항) 삭제되지않은 글 총 게시물 수 -->
   <select id="noticeBoardListCount" parameterType="com.sist.web.model.BoardNotice" resultType="long" >
      SELECT COUNT(A.BRD_SEQ) AS CNT
        FROM EDU_NOTICE A, EDU_ADMIN B
       WHERE A.USER_ID = B.USER_ID
         AND A.DEL_DATE IS NULL
       
      <if test='searchType != null and searchType != "" and searchValue != null and searchValue != ""'>                                      
         <choose>
         
            <when test='searchType == "1"'>
                    AND A.BRD_TITLE LIKE '%' || #{searchValue} || '%'
                </when>
                
                <when test='searchType == "2"'>
                    AND A.BRD_CONTENT LIKE '%' || #{searchValue} || '%'
                </when>
               
            </choose>     
      </if>      
   </select>
   
   <!-- NOTICE(공지사항) 삭제된 글 총 게시물 수 -->
   <select id="noticeDelBoardListCount" parameterType="com.sist.web.model.BoardNotice" resultType="long" >
      SELECT COUNT(A.BRD_SEQ) AS CNT
        FROM EDU_NOTICE A, EDU_ADMIN B
       WHERE A.USER_ID = B.USER_ID
         AND A.DEL_DATE IS NOT NULL
       
      <if test='searchType != null and searchType != "" and searchValue != null and searchValue != ""'>                                      
         <choose>
         
            <when test='searchType == "1"'>
                    AND A.BRD_TITLE LIKE '%' || #{searchValue} || '%'
                </when>
                
                <when test='searchType == "2"'>
                    AND A.BRD_CONTENT LIKE '%' || #{searchValue} || '%'
                </when>
               
            </choose>     
      </if>      
   </select>
   
   <!-- NOTICE(공지사항) 게시물 조회 -->
   <select id="noticeBoardSelect" parameterType="long" resultMap="BoardNoticeResultMap">
      SELECT A.BRD_SEQ,
               B.USER_ID,
               NVL(A.BRD_TITLE, '') BRD_TITLE,
               NVL(A.BRD_CONTENT, '') BRD_CONTENT,
               NVL(C.FILE_ORG_NAME, '') FILE_ORG_NAME,
             NVL(C.FILE_NAME, '') FILE_NAME,
               NVL(A.BRD_READ_CNT, '') BRD_READ_CNT,
               NVL(TO_CHAR(A.REG_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') REG_DATE,
               NVL(TO_CHAR(A.MOD_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') MOD_DATE,
               NVL(TO_CHAR(A.DEL_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') DEL_DATE,
               NVL(A.IS_MUST, 'N') IS_MUST
          FROM EDU_NOTICE A, EDU_ADMIN B, EDU_NOTICE_FILE C
       WHERE A.BRD_SEQ = #{brdSeq}
         AND A.USER_ID = B.USER_ID
         AND A.BRD_SEQ = C.BRD_SEQ(+) 
   </select>
   
   
   <!-- NOTICE(공지사항) 게시물 조회수 증가 -->
   <update id="noticeReadCntPlus" parameterType="long">
      UPDATE EDU_NOTICE
         SET BRD_READ_CNT = BRD_READ_CNT + 1
       WHERE BRD_SEQ = #{brdSeq}
   </update>
   
   <!-- NOTICE(공지사항) 게시물 삭제 -->
   <delete id="noticeRealBoardDelete" parameterType="long">
      DELETE FROM EDU_NOTICE
       WHERE BRD_SEQ = #{brdSeq}
   </delete>
   
   <!-- NOTICE(공지사항) 게시물 삭제 -->
   <delete id="noticeRealBoardFileDelete" parameterType="long">
      DELETE FROM EDU_NOTICE_FILE
       WHERE BRD_SEQ = #{brdSeq}
   </delete>
   
   <!-- NOTICE(공지사항) 게시물 삭제(DEL_DATE 업데이트) -->
   <delete id="noticeBoardDelete" parameterType="com.sist.web.model.BoardNotice">
       UPDATE EDU_NOTICE
          SET DEL_DATE = SYSDATE
        WHERE BRD_SEQ = #{brdSeq}
   </delete>
   
   <!-- NOTICE(공지사항) 게시물 수정 -->
    <update id="noticeBoardUpdate" parameterType="com.sist.web.model.BoardNotice">
       UPDATE EDU_NOTICE
          SET BRD_TITLE = #{brdTitle},
              BRD_CONTENT = #{brdContent},
              MOD_DATE = SYSDATE,
              IS_MUST = #{isMust}
        WHERE BRD_SEQ = #{brdSeq}
    </update>
   
    <!--  NOTICE(공지사항) 이전글 조회 -->
    <select id="getPrevNotice" parameterType="long" resultMap="BoardNoticeResultMap">
        SELECT A.BRD_SEQ,
               B.USER_ID,
               NVL(A.BRD_TITLE, '') BRD_TITLE,
               NVL(A.BRD_CONTENT, '') BRD_CONTENT,
               NVL(A.BRD_READ_CNT, '') BRD_READ_CNT,
               NVL(TO_CHAR(A.REG_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') REG_DATE,
               NVL(TO_CHAR(A.MOD_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') MOD_DATE,
               NVL(TO_CHAR(A.DEL_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') DEL_DATE,
               NVL(A.IS_MUST, 'N') IS_MUST
        FROM EDU_NOTICE A, EDU_ADMIN B
        WHERE A.BRD_SEQ <![CDATA[<]]> #{brdSeq}
          AND A.USER_ID = B.USER_ID
          
        ORDER BY A.BRD_SEQ DESC
        FETCH FIRST 1 ROWS ONLY
    </select>

    <!-- NOTICE(공지사항) 다음글 조회 -->
    <select id="getNextNotice" parameterType="long" resultMap="BoardNoticeResultMap">
        SELECT A.BRD_SEQ,
               B.USER_ID,
               NVL(A.BRD_TITLE, '') BRD_TITLE,
               NVL(A.BRD_CONTENT, '') BRD_CONTENT,
               NVL(A.BRD_READ_CNT, '') BRD_READ_CNT,
               NVL(TO_CHAR(A.REG_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') REG_DATE,
               NVL(TO_CHAR(A.MOD_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') MOD_DATE,
               NVL(TO_CHAR(A.DEL_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') DEL_DATE,
               NVL(A.IS_MUST, 'N') IS_MUST
        FROM EDU_NOTICE A, EDU_ADMIN B
        WHERE A.BRD_SEQ <![CDATA[>]]> #{brdSeq}
          AND A.USER_ID = B.USER_ID
          
        ORDER BY A.BRD_SEQ ASC
        FETCH FIRST 1 ROWS ONLY
    </select>
    
<!-- #############################################공지사항(끝)############################################# -->
         <!-- ################################################################################ -->
                  <!-- ###################################################### -->







                  <!-- ###################################################### -->
         <!-- ################################################################################ -->
<!-- ############################################문의사항(시작)############################################# -->

   <!-- QNA(문의사항) 게시물 등록 -->
   <insert id="qnaBoardInsert" parameterType="com.sist.web.model.BoardQna">
      <!-- 선행처리기(시퀀스조회) -->
      <selectKey resultType="long" keyProperty="brdSeq" order="BEFORE">
         SELECT SEQ_BOARD_QNA_SEQ.NEXTVAL FROM DUAL
      </selectKey>
      
      INSERT INTO EDU_QNA (
         BRD_SEQ,
         BRD_TITLE,
         BRD_CONTENT,
         BRD_READ_CNT,
         BRD_PARENT,
         REG_DATE,
         MOD_DATE,
         BRD_PWD,
         USER_ID
      ) VALUES (
          #{brdSeq},
          #{brdTitle},
          #{brdContent},
          0,
          #{brdParent},
          SYSDATE,
          SYSDATE,
          #{brdPwd},
          #{userId}
      )
   
   </insert>
   
   <!-- QNA(문의사항) 첨부파일 등록 -->
   <insert id="qnaBoardFileInsert" parameterType="com.sist.web.model.BoardQnaFile">
      INSERT INTO EDU_QNA_FILE (
          FILE_SEQ,
          BRD_SEQ,
          FILE_NAME,
          FILE_ORG_NAME,
          FILE_EXT,
          FILE_SIZE,
          REG_DATE
      ) VALUES (
          #{fileSeq},
          #{brdSeq},
          #{fileName},
          #{fileOrgName},
          #{fileExt},
          #{fileSize},
          SYSDATE
      )
   </insert>
   
   <!-- QNA(문의사항) 첨부파일 조회 -->
   <select id="qnaBoardFileSelect" parameterType="long" resultMap="BoardQnaFileResultMap">
      SELECT FILE_SEQ,
             BRD_SEQ,
             NVL(FILE_NAME, '') FILE_NAME,
             NVL(FILE_ORG_NAME, '') FILE_ORG_NAME,
             NVL(FILE_EXT, '') FILE_EXT,
             NVL(FILE_SIZE, 0) FILE_SIZE,
             NVL(TO_CHAR(REG_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') REG_DATE
      FROM EDU_QNA_FILE
      WHERE BRD_SEQ = #{value}
        AND FILE_SEQ = 1
   </select>
   
   <!-- QNA(문의사항) 첨부파일 삭제 -->
   <delete id="qnaBoardFileDelete" parameterType="long">
      DELETE FROM EDU_QNA_FILE
       WHERE BRD_SEQ = #{value}
   </delete>
      
   
   <!-- QNA(문의사항) 게시글 리스트 -->
   <select id="qnaBoardList" parameterType="com.sist.web.model.BoardQna" resultMap="BoardQnaResultMap">
      SELECT BRD_SEQ,
            BRD_TITLE,
            BRD_CONTENT,
            BRD_READ_CNT,
            BRD_PARENT,
            REG_DATE,
            MOD_DATE,
            DEL_DATE,
            BRD_PWD,
            USER_ID,
            USER_NAME
        FROM (SELECT ROWNUM AS RNUM,
                     BRD_SEQ,
                  BRD_TITLE,
                  BRD_CONTENT,
                  BRD_READ_CNT,
                  BRD_PARENT,
                  REG_DATE,
                  MOD_DATE,
                  DEL_DATE,
                  BRD_PWD,
                  USER_ID,
                  USER_NAME
                FROM (SELECT A.BRD_SEQ,
                             B.USER_ID,
                             NVL(A.BRD_TITLE, '') BRD_TITLE,
                             NVL(A.BRD_CONTENT, '') BRD_CONTENT,
                             NVL(A.BRD_READ_CNT, '') BRD_READ_CNT,
                             NVL(A.BRD_PARENT, '') BRD_PARENT,
                             NVL(TO_CHAR(A.REG_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') REG_DATE,
                             NVL(TO_CHAR(A.MOD_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') MOD_DATE,
                             NVL(TO_CHAR(A.DEL_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') DEL_DATE,
                             NVL(A.BRD_PWD, '') BRD_PWD,
                             (SELECT USER_NAME FROM
                             (SELECT USER_ID, USER_NAME
						         FROM EDU_USER
						             
						      UNION ALL
						             
						       SELECT USER_ID, USER_NAME
						         FROM EDU_TEACHER)
						        WHERE USER_ID = A.USER_ID
                               ) USER_NAME
                        FROM EDU_QNA A, EDU_USER B
                       WHERE A.USER_ID = B.USER_ID
                         AND A.BRD_PARENT = 0
                         AND A.DEL_DATE IS NULL
          
                         
            <if test='searchType != null and searchType != "" and searchValue != null and searchValue != ""'>                         
                     AND A.BRD_PWD IS NULL
               <choose>
               
                  <when test='searchType == "1"'>
                          AND A.BRD_TITLE LIKE '%' || #{searchValue} || '%'
                      </when>
                      
                      <when test='searchType == "2"'>
                          AND A.BRD_CONTENT LIKE '%' || #{searchValue} || '%'
                      </when>
                      
                      <when test='searchType == "3"'>
                          AND A.USER_ID LIKE '%' || #{searchValue} || '%'
                      </when>
                     
                  </choose>    
            
            </if>
              
                      ORDER BY A.BRD_SEQ DESC))
       WHERE RNUM <![CDATA[>=]]> #{startRow}
         AND RNUM <![CDATA[<=]]> #{endRow}

   
   </select>
   
   <!-- QNA(문의사항) 삭제된 게시글 리스트 -->
   <select id="qnaDelBoardList" parameterType="com.sist.web.model.BoardQna" resultMap="BoardQnaResultMap">
      SELECT BRD_SEQ,
            BRD_TITLE,
            BRD_CONTENT,
            BRD_READ_CNT,
            BRD_PARENT,
            REG_DATE,
            MOD_DATE,
            DEL_DATE,
            BRD_PWD,
            USER_ID,
            USER_NAME
        FROM (SELECT ROWNUM AS RNUM,
                     BRD_SEQ,
                  BRD_TITLE,
                  BRD_CONTENT,
                  BRD_READ_CNT,
                  BRD_PARENT,
                  REG_DATE,
                  MOD_DATE,
                  DEL_DATE,
                  BRD_PWD,
                  USER_ID,
                  USER_NAME
                FROM (SELECT A.BRD_SEQ,
                             B.USER_ID,
                             NVL(A.BRD_TITLE, '') BRD_TITLE,
                             NVL(A.BRD_CONTENT, '') BRD_CONTENT,
                             NVL(A.BRD_READ_CNT, '') BRD_READ_CNT,
                             NVL(A.BRD_PARENT, '') BRD_PARENT,
                             NVL(TO_CHAR(A.REG_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') REG_DATE,
                             NVL(TO_CHAR(A.MOD_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') MOD_DATE,
                             NVL(TO_CHAR(A.DEL_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') DEL_DATE,
                             NVL(A.BRD_PWD, '') BRD_PWD,
                             (SELECT USER_NAME FROM
                             (SELECT USER_ID, USER_NAME
						         FROM EDU_USER
						             
						      UNION ALL
						             
						       SELECT USER_ID, USER_NAME
						         FROM EDU_TEACHER)
						        WHERE USER_ID = A.USER_ID
                               ) USER_NAME
                        FROM EDU_QNA A, EDU_USER B
                       WHERE A.USER_ID = B.USER_ID
                         AND A.BRD_PARENT = 0
                         AND A.DEL_DATE IS NOT NULL
          
                         
            <if test='searchType != null and searchType != "" and searchValue != null and searchValue != ""'>                         
                     AND A.BRD_PWD IS NULL
               <choose>
               
                  <when test='searchType == "1"'>
                          AND A.BRD_TITLE LIKE '%' || #{searchValue} || '%'
                      </when>
                      
                      <when test='searchType == "2"'>
                          AND A.BRD_CONTENT LIKE '%' || #{searchValue} || '%'
                      </when>
                      
                      <when test='searchType == "3"'>
                          AND A.USER_ID LIKE '%' || #{searchValue} || '%'
                      </when>
                     
                  </choose>    
            
            </if>
              
                      ORDER BY A.BRD_SEQ DESC))
       WHERE RNUM <![CDATA[>=]]> #{startRow}
         AND RNUM <![CDATA[<=]]> #{endRow}

   
   </select>
   
   <!-- QNA(문의사항)마이페이지 게시글 리스트 -->
   <select id="myPageQnaList" parameterType="com.sist.web.model.BoardQna" resultMap="BoardQnaResultMap">
         SELECT BRD_SEQ,
              BRD_TITLE,
              BRD_CONTENT,
              BRD_READ_CNT,
              BRD_PARENT,
              REG_DATE,
              MOD_DATE,
              DEL_DATE,
              BRD_PWD,
              USER_ID
         FROM (SELECT ROWNUM AS RNUM,
                      BRD_SEQ,
                      BRD_TITLE,
                      BRD_CONTENT,
                      BRD_READ_CNT,
                      BRD_PARENT,
                      REG_DATE,
                      MOD_DATE,
                      DEL_DATE,
                      BRD_PWD,
                      USER_ID
                 FROM (SELECT A.BRD_SEQ,
                              B.USER_ID,
                              NVL(A.BRD_TITLE, '') BRD_TITLE,
                              NVL(A.BRD_CONTENT, '') BRD_CONTENT,
                              NVL(A.BRD_READ_CNT, '') BRD_READ_CNT,
                              NVL(A.BRD_PARENT, '') BRD_PARENT,
                              NVL(TO_CHAR(A.REG_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') REG_DATE,
                              NVL(TO_CHAR(A.MOD_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') MOD_DATE,
                              NVL(TO_CHAR(A.DEL_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') DEL_DATE,
                              NVL(A.BRD_PWD, '') BRD_PWD
                         FROM EDU_QNA A, EDU_USER B
                        WHERE A.USER_ID = B.USER_ID
                          AND A.BRD_PARENT = 0
                          AND A.USER_ID = #{userId}
                          AND A.DEL_DATE IS NULL
                       ORDER BY A.BRD_SEQ DESC))
        WHERE RNUM <![CDATA[>=]]> #{startRow}
          AND RNUM <![CDATA[<=]]> #{endRow}
   </select>
   
   
   
   <!-- QNA(문의사항) 총 게시물 수 -->
   <select id="qnaBoardListCount" parameterType="com.sist.web.model.BoardQna" resultType="long" >
      SELECT COUNT(A.BRD_SEQ) AS CNT
        FROM EDU_QNA A, EDU_USER B
       WHERE A.USER_ID = B.USER_ID
         AND A.BRD_PARENT = 0
         AND A.DEL_DATE IS NULL
       
      <if test='searchType != null and searchType != "" and searchValue != null and searchValue != ""'>                                      
         <choose>
         
            <when test='searchType == "1"'>
                    AND A.BRD_TITLE LIKE '%' || #{searchValue} || '%'
                </when>
                
                <when test='searchType == "2"'>
                    AND A.BRD_CONTENT LIKE '%' || #{searchValue} || '%'
                </when>
               
            </choose>     
      </if>      
   </select>
   
   <!-- QNA(문의사항) 삭제된 총 게시물 수 -->
   <select id="qnaDelBoardListCount" parameterType="com.sist.web.model.BoardQna" resultType="long" >
      SELECT COUNT(A.BRD_SEQ) AS CNT
        FROM EDU_QNA A, EDU_USER B
       WHERE A.USER_ID = B.USER_ID
         AND A.BRD_PARENT = 0
         AND A.DEL_DATE IS NOT NULL
       
      <if test='searchType != null and searchType != "" and searchValue != null and searchValue != ""'>                                      
         <choose>
         
            <when test='searchType == "1"'>
                    AND A.BRD_TITLE LIKE '%' || #{searchValue} || '%'
                </when>
                
                <when test='searchType == "2"'>
                    AND A.BRD_CONTENT LIKE '%' || #{searchValue} || '%'
                </when>
               
            </choose>     
      </if>      
   </select>
   
   <!-- QNA(문의사항)마이페이지 총 게시물 수 -->
   <select id="qnaMyPageListCount" parameterType="String" resultType="long" >
      SELECT COUNT(A.BRD_SEQ) AS CNT
        FROM EDU_QNA A, EDU_USER B
       WHERE A.USER_ID = B.USER_ID
         AND A.BRD_PARENT = 0
         AND A.USER_ID = #{value}   
         AND A.DEL_DATE IS NULL
   </select>
   
   <!-- QNA(문의사항) 게시물 조회 -->
   <select id="qnaBoardSelect" parameterType="long" resultMap="BoardQnaResultMap">
      SELECT A.BRD_SEQ,
               B.USER_ID,
               NVL(A.BRD_TITLE, '') BRD_TITLE,
               NVL(A.BRD_CONTENT, '') BRD_CONTENT,
               NVL(B.USER_EMAIL, '') USER_EMAIL,
               NVL(C.FILE_ORG_NAME, '') FILE_ORG_NAME,
               NVL(C.FILE_NAME, '') FILE_NAME,
               NVL(A.BRD_READ_CNT, '') BRD_READ_CNT,
               NVL(A.BRD_PARENT, '') BRD_PARENT,
               NVL(TO_CHAR(A.REG_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') REG_DATE,
               NVL(TO_CHAR(A.MOD_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') MOD_DATE,
               NVL(TO_CHAR(A.DEL_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') DEL_DATE,
               NVL(A.BRD_PWD, '') BRD_PWD,
               (SELECT USER_NAME FROM
				(SELECT USER_ID, USER_NAME
						         FROM EDU_USER
						             
						      UNION ALL
						             
						       SELECT USER_ID, USER_NAME
						         FROM EDU_TEACHER)
						        WHERE USER_ID = A.USER_ID
                               ) USER_NAME
          FROM EDU_QNA A, (SELECT USER_ID, USER_EMAIL FROM EDU_USER UNION ALL SELECT USER_ID, USER_EMAIL FROM EDU_ADMIN) B, EDU_QNA_FILE C
       WHERE A.BRD_SEQ = #{brdSeq}
         AND A.USER_ID = B.USER_ID
         AND A.BRD_SEQ = C.BRD_SEQ(+) 
   </select>
   
   
   <!-- QNA(문의사항) 게시물 조회수 증가 -->
   <update id="qnaReadCntPlus" parameterType="long">
      UPDATE EDU_QNA
         SET BRD_READ_CNT = BRD_READ_CNT + 1
       WHERE BRD_SEQ = #{brdSeq}
   </update>
   
   <!-- QNA(문의사항) 게시물 삭제(DEL_DATE 업데이트) -->
   <delete id="qnaBoardDelete" parameterType="com.sist.web.model.BoardQna">
       UPDATE EDU_QNA
          SET DEL_DATE = SYSDATE
        WHERE BRD_SEQ = #{brdSeq}
   </delete>
   
   
   
   
   
	<delete id="qnaRealBoardCommFileDelete" parameterType="long">
	    DELETE FROM EDU_QNA_FILE 
	    WHERE BRD_SEQ IN (SELECT BRD_SEQ FROM EDU_QNA WHERE BRD_PARENT = #{brdSeq})
	</delete>
	
	<delete id="qnaRealBoardFileDelete" parameterType="long">
	    DELETE FROM EDU_QNA_FILE 
	    WHERE BRD_SEQ = #{brdSeq}
	</delete>
	
	<delete id="qnaRealBoardDeleteQna" parameterType="long">
	    DELETE FROM EDU_QNA 
	    WHERE BRD_SEQ = #{brdSeq}
	</delete>
	
	<delete id="qnaRealBoardDeleteParent" parameterType="long">
	    DELETE FROM EDU_QNA 
	    WHERE BRD_PARENT = #{brdSeq}
	</delete>




   
   <!-- QNA(문의사항) 게시물 수정 -->
    <update id="qnaBoardUpdate" parameterType="com.sist.web.model.BoardQna">
       UPDATE EDU_QNA
          SET BRD_TITLE = #{brdTitle},
              BRD_CONTENT = #{brdContent},
              BRD_PWD = #{brdPwd},
              MOD_DATE = SYSDATE
        WHERE BRD_SEQ = #{brdSeq}
    </update>
    
   <!-- QNA(문의사항) 답변 수정 -->
    <update id="qnaCommBoardUpdate" parameterType="com.sist.web.model.BoardQna">
       UPDATE EDU_QNA
          SET BRD_TITLE = #{brdTitle},
              BRD_CONTENT = #{brdContent},
              BRD_PWD = #{brdPwd},
              MOD_DATE = SYSDATE
        WHERE BRD_PARENT = #{brdSeq}
    </update>
    
    
    
    <!-- 게시물 답글 등록 -->
   <insert id="boardCommInsert" parameterType="com.sist.web.model.BoardQna">
   
       <!-- 선행처리기(시퀀스 조회) -->
       <selectKey resultType="long" keyProperty="brdSeq" order="BEFORE">
           SELECT SEQ_BOARD_QNA_SEQ.NEXTVAL FROM DUAL
       </selectKey>
   
       INSERT INTO EDU_QNA (
           BRD_SEQ,
           BRD_TITLE,
           BRD_CONTENT,
           BRD_READ_CNT,
           BRD_PARENT,
           REG_DATE,
           MOD_DATE,
           BRD_PWD,
           USER_ID
       ) VALUES (
           #{brdSeq},
           #{brdTitle},
           #{brdContent},
           0,
           #{brdParent},
           SYSDATE,
           SYSDATE,
           #{brdPwd},
           #{userId}
       )
   </insert>
   
   
   <!-- QNA(문의사항) 답글(이미지) 조회 -->
   <select id="qnaCommBoardSelect" parameterType="long" resultMap="BoardQnaResultMap">
      SELECT A.BRD_SEQ,
               B.USER_ID,
               NVL(A.BRD_TITLE, '') BRD_TITLE,
               NVL(A.BRD_CONTENT, '') BRD_CONTENT,
               NVL(B.USER_EMAIL, '') USER_EMAIL,
               NVL(C.FILE_ORG_NAME, '') FILE_ORG_NAME,
             NVL(C.FILE_NAME, '') FILE_NAME,
               NVL(A.BRD_READ_CNT, '') BRD_READ_CNT,
               NVL(A.BRD_PARENT, '') BRD_PARENT,
               NVL(TO_CHAR(A.REG_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') REG_DATE,
               NVL(TO_CHAR(A.MOD_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') MOD_DATE,
               NVL(TO_CHAR(A.DEL_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') DEL_DATE,
               NVL(A.BRD_PWD, '') BRD_PWD
          FROM EDU_QNA A, EDU_ADMIN B, EDU_QNA_FILE C
       WHERE A.BRD_PARENT = #{brdParent}
         AND A.USER_ID = B.USER_ID
         AND A.BRD_SEQ = C.BRD_SEQ(+) 
   </select>
   
   <!-- QNA(문의사항) 답글 유무 확인 -->
   <select id="countRepliesByBrdSeq" resultType="int" parameterType="long">
       SELECT COUNT(*)
         FROM EDU_QNA
        WHERE BRD_PARENT = #{brdSeq}
   </select>

   <!-- QNA(문의사항) 첨부파일 조회 -->
   <select id="qnaCommBoardFileSelect" parameterType="long" resultMap="BoardQnaFileResultMap">
      SELECT A.FILE_SEQ,
             A.BRD_SEQ,
             NVL(A.FILE_NAME, '') FILE_NAME,
             NVL(A.FILE_ORG_NAME, '') FILE_ORG_NAME,
             NVL(A.FILE_EXT, '') FILE_EXT,
             NVL(A.FILE_SIZE, 0) FILE_SIZE,
             NVL(TO_CHAR(A.REG_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') REG_DATE
      FROM EDU_QNA_FILE A
      WHERE A.BRD_SEQ = #{value}
        AND FILE_SEQ = 1
   </select>
   

   
   


   
<!-- #############################################문의사항(끝)############################################# -->   
         <!-- ################################################################################ -->
                  <!-- ###################################################### -->
                  
                  
                  <!-- ###################################################### -->   
         <!-- ################################################################################ -->
<!-- #############################################자유게시판(시작)########################################### -->   
<!-- 자유게시판 게시물 등록 -->
   <insert id="freeBoardInsert" parameterType="com.sist.web.model.Board">
      <!-- 선행 처리기(시퀀스 조회) -->
        <selectKey resultType="long" keyProperty="brdSeq" order="BEFORE">
           SELECT SEQ_BOARD_FREE_SEQ.NEXTVAL FROM DUAL
        </selectKey>
        
        INSERT INTO EDU_BOARD (
              BRD_SEQ,
               USER_ID,
               BRD_TITLE,
               BRD_CONTENT,
               BRD_READ_CNT,
               BRD_SECRET,
               REG_DATE,
               MOD_DATE,
               DEL_DATE,
               CATEGORY
           ) VALUES (
               #{brdSeq},
               #{userId},
               #{brdTitle},
               #{brdContent},
               0,
               #{brdSecret},
               SYSDATE,
               #{modDate},
               #{delDate},
               #{category}
           )
   </insert>
   
   <!-- 첨부파일 등록 -->
    <insert id="freeBoardFileInsert" parameterType="com.sist.web.model.BoardFile">
         INSERT INTO EDU_BOARD_FILE (
                BRD_SEQ,
                FILE_SEQ,
                FILE_ORG_NAME,
                FILE_NAME,
                FILE_EXT,
                FILE_SIZE,
                REG_DATE
            ) VALUES (
                #{brdSeq},
                #{fileSeq},
                #{fileOrgName},
                #{fileName},
                #{fileExt},
                #{fileSize},
                SYSDATE
            )
    </insert>
   
    <!-- 게시물 리스트 -->
    <select id="freeBoardList" parameterType="com.sist.web.model.Board" resultMap="boardResultMap">
      SELECT  BRD_SEQ,
              USER_ID,
              BRD_TITLE,
              BRD_CONTENT,
              BRD_READ_CNT,
              BRD_SECRET,
              REG_DATE,
              MOD_DATE,
              DEL_DATE,
              CATEGORY,
              COM,
              RECOM,
              USER_PROFILE,
              USER_NAME
        FROM  (SELECT ROWNUM AS RNUM,
                      BRD_SEQ,
                      USER_ID,
                      BRD_TITLE,
                      BRD_CONTENT,
                      BRD_READ_CNT,
                      BRD_SECRET,
                      REG_DATE,
                      MOD_DATE,
                      DEL_DATE,
                      CATEGORY,
                      COM,
                      RECOM,
                      USER_PROFILE,
                      USER_NAME
                FROM  (SELECT BRD_SEQ AS BRD_SEQ,
                              B.USER_ID,
                              NVL(BRD_TITLE, '') AS BRD_TITLE,
                              NVL(BRD_CONTENT, '') AS BRD_CONTENT,
                              NVL(BRD_READ_CNT, 0) AS BRD_READ_CNT,
                              NVL(BRD_SECRET, '') AS BRD_SECRET,
                              NVL(TO_CHAR(REG_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') AS REG_DATE,
                              NVL(TO_CHAR(MOD_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') AS MOD_DATE,
                              NVL(TO_CHAR(DEL_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') AS DEL_DATE,
                              NVL(CATEGORY, 0) AS CATEGORY
                              ,(SELECT COUNT(1)
                                   FROM EDU_BOARD_COM EDU_BOARD_COM
                                  WHERE 1=1
                                    AND EDU_BOARD_COM.BRD_SEQ = B.BRD_SEQ) AS COM,
                                (SELECT COUNT(1)
                                   FROM EDU_BOARD_RECOM
                                  WHERE 1=1
                                    AND EDU_BOARD_RECOM.BRD_SEQ = B.BRD_SEQ) AS RECOM,
                              (SELECT USER_PROFILE FROM EDU_USER WHERE B.USER_ID = EDU_USER.USER_ID) USER_PROFILE,
                              (SELECT USER_NAME FROM 
                              (SELECT USER_ID, USER_NAME
						         FROM EDU_USER
						             
						      UNION ALL
						             
						       SELECT USER_ID, USER_NAME
						         FROM EDU_TEACHER)
						        WHERE USER_ID = B.USER_ID
                               ) USER_NAME
                        FROM EDU_BOARD B, (SELECT USER_ID, USER_NAME
						         FROM EDU_USER
						             
						      UNION ALL
						             
						       SELECT USER_ID, USER_NAME
						         FROM EDU_TEACHER) A
                       WHERE 1 = 1
                         AND DEL_DATE IS NULL
                         AND B.USER_ID = A.USER_ID
                       <if test='searchType != null and searchType != "" and searchValue != null and searchValue != ""'>
                           <choose>
                                 <when test='searchType == "0"'>
                                      AND (A.USER_ID LIKE '%'||#{searchValue}||'%' 
                                OR BRD_TITLE LIKE '%'||#{searchValue}||'%'
                                OR DBMS_LOB.INSTR(BRD_CONTENT, #{searchValue}) > 0)

                                 </when>
                               <when test='searchType == "1"'>                       
                                   AND A.USER_ID LIKE '%'||#{searchValue}||'%'
                               </when>                
                               <when test='searchType == "2"'> 
                                   AND BRD_TITLE LIKE '%'||#{searchValue}||'%'
                               </when>
                               <when test='searchType == "3"'>
                                   AND DBMS_LOB.INSTR(BRD_CONTENT, #{searchValue}) > 0
                               </when>
                               <when test='searchType == "4"'>
                           AND A.USER_NAME LIKE '%'||#{searchValue}||'%'
                               </when>
                           </choose>
                       </if>
                        <if test='category != null and category != ""'>
                       AND B.CATEGORY = #{category}
                   </if>
                   ORDER BY 
                   <if test='options == "1"'>
                          REG_DATE
                       </if>
                       <if test='options == "2"'>
                          RECOM
                       </if>
                       <if test='options == "3"'>
                          BRD_READ_CNT
                       </if>
                       <if test='options == "4"'>
                          COM
                       </if>
                       
                        DESC))
      WHERE RNUM <![CDATA[>=]]> #{startRow}
          AND RNUM <![CDATA[<=]]> #{endRow}
   </select>
   
   <!-- 총 게시물 수 -->
    <select id="freeBoardListCount" parameterType="com.sist.web.model.Board" resultType="long">
        SELECT COUNT(BRD_SEQ) AS CNT
          FROM EDU_BOARD
          WHERE DEL_DATE IS NULL
        <if test='searchType != null and searchType != "" and searchValue != null and searchValue != ""'>
            <choose>
                  <when test='searchType == "0"'>
                      AND (USER_ID LIKE '%'||#{searchValue}||'%' 
                 OR BRD_TITLE LIKE '%'||#{searchValue}||'%'
                 OR DBMS_LOB.INSTR(BRD_CONTENT, #{searchValue}) > 0)
                 </when>
                <when test='searchType == "1"'>
                    AND USER_ID LIKE '%'||#{searchValue}||'%'
                </when>                
                <when test='searchType == "2"'> 
                    AND BRD_TITLE LIKE '%'||#{searchValue}||'%'
                </when>
                <when test='searchType == "3"'>
                    AND DBMS_LOB.INSTR(BRD_CONTENT, #{searchValue}) > 0
                </when>
            </choose>                    
        </if>
         <if test='category != null and category != ""'>
           AND CATEGORY = #{category}
       </if>
    </select>
    
    <!-- 삭제된 게시물 리스트 -->
    <select id="freeDelBoardList" parameterType="com.sist.web.model.Board" resultMap="boardResultMap">
      SELECT  BRD_SEQ,
              USER_ID,
              BRD_TITLE,
              BRD_CONTENT,
              BRD_READ_CNT,
              BRD_SECRET,
              REG_DATE,
              MOD_DATE,
              DEL_DATE,
              CATEGORY,
              COM,
              RECOM,
              USER_PROFILE,
              USER_NAME
        FROM  (SELECT ROWNUM AS RNUM,
                      BRD_SEQ,
                      USER_ID,
                      BRD_TITLE,
                      BRD_CONTENT,
                      BRD_READ_CNT,
                      BRD_SECRET,
                      REG_DATE,
                      MOD_DATE,
                      DEL_DATE,
                      CATEGORY,
                      COM,
                      RECOM,
                      USER_PROFILE,
                      USER_NAME
                FROM  (SELECT BRD_SEQ AS BRD_SEQ,
                              B.USER_ID,
                              NVL(BRD_TITLE, '') AS BRD_TITLE,
                              NVL(BRD_CONTENT, '') AS BRD_CONTENT,
                              NVL(BRD_READ_CNT, 0) AS BRD_READ_CNT,
                              NVL(BRD_SECRET, '') AS BRD_SECRET,
                              NVL(TO_CHAR(REG_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') AS REG_DATE,
                              NVL(TO_CHAR(MOD_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') AS MOD_DATE,
                              NVL(TO_CHAR(DEL_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') AS DEL_DATE,
                              NVL(CATEGORY, 0) AS CATEGORY
                              ,(SELECT COUNT(1)
                                   FROM EDU_BOARD_COM EDU_BOARD_COM
                                  WHERE 1=1
                                    AND EDU_BOARD_COM.BRD_SEQ = B.BRD_SEQ) AS COM,
                                (SELECT COUNT(1)
                                   FROM EDU_BOARD_RECOM
                                  WHERE 1=1
                                    AND EDU_BOARD_RECOM.BRD_SEQ = B.BRD_SEQ) AS RECOM,
                              (SELECT USER_PROFILE FROM EDU_USER WHERE B.USER_ID = EDU_USER.USER_ID) USER_PROFILE,
                              (SELECT USER_NAME FROM 
                              (SELECT USER_ID, USER_NAME
						         FROM EDU_USER
						             
						      UNION ALL
						             
						       SELECT USER_ID, USER_NAME
						         FROM EDU_TEACHER)
						        WHERE USER_ID = B.USER_ID
                               ) USER_NAME
                        FROM EDU_BOARD B, (SELECT USER_ID, USER_NAME
						         FROM EDU_USER
						             
						      UNION ALL
						             
						       SELECT USER_ID, USER_NAME
						         FROM EDU_TEACHER) A
                       WHERE 1 = 1
                         AND DEL_DATE IS NOT NULL
                         AND B.USER_ID = A.USER_ID
                       <if test='searchType != null and searchType != "" and searchValue != null and searchValue != ""'>
                           <choose>
                                 <when test='searchType == "0"'>
                                      AND (A.USER_ID LIKE '%'||#{searchValue}||'%' 
                                OR BRD_TITLE LIKE '%'||#{searchValue}||'%'
                                OR DBMS_LOB.INSTR(BRD_CONTENT, #{searchValue}) > 0)

                                 </when>
                               <when test='searchType == "1"'>                       
                                   AND A.USER_ID LIKE '%'||#{searchValue}||'%'
                               </when>                
                               <when test='searchType == "2"'> 
                                   AND BRD_TITLE LIKE '%'||#{searchValue}||'%'
                               </when>
                               <when test='searchType == "3"'>
                                   AND DBMS_LOB.INSTR(BRD_CONTENT, #{searchValue}) > 0
                               </when>
                               <when test='searchType == "4"'>
								   AND A.USER_NAME LIKE '%'||#{searchValue}||'%'
                               </when>
                           </choose>
                       </if>
                        <if test='category != null and category != ""'>
                       AND B.CATEGORY = #{category}
                   </if>
                   ORDER BY 
                   <if test='options == "1"'>
                          REG_DATE
                       </if>
                       <if test='options == "2"'>
                          RECOM
                       </if>
                       <if test='options == "3"'>
                          BRD_READ_CNT
                       </if>
                       <if test='options == "4"'>
                          COM
                       </if>
                       
                        DESC))
      WHERE RNUM <![CDATA[>=]]> #{startRow}
          AND RNUM <![CDATA[<=]]> #{endRow}
   </select>
   
   <!-- 삭제된 총 게시물 수 -->
    <select id="freeDelBoardListCount" parameterType="com.sist.web.model.Board" resultType="long">
        SELECT COUNT(BRD_SEQ) AS CNT
          FROM EDU_BOARD
          WHERE DEL_DATE IS NOT NULL
        <if test='searchType != null and searchType != "" and searchValue != null and searchValue != ""'>
            <choose>
                  <when test='searchType == "0"'>
                      AND (USER_ID LIKE '%'||#{searchValue}||'%' 
                 OR BRD_TITLE LIKE '%'||#{searchValue}||'%'
                 OR DBMS_LOB.INSTR(BRD_CONTENT, #{searchValue}) > 0)
                 </when>
                <when test='searchType == "1"'>
                    AND USER_ID LIKE '%'||#{searchValue}||'%'
                </when>                
                <when test='searchType == "2"'> 
                    AND BRD_TITLE LIKE '%'||#{searchValue}||'%'
                </when>
                <when test='searchType == "3"'>
                    AND DBMS_LOB.INSTR(BRD_CONTENT, #{searchValue}) > 0
                </when>
            </choose>                    
        </if>
         <if test='category != null and category != ""'>
           AND CATEGORY = #{category}
       </if>
    </select>
    
    <!-- 게시물 조회 -->
   <select id="freeBoardSelect" parameterType="long" resultMap="boardResultMap">
       SELECT
          BRD_SEQ,
          NVL(USER_ID, '') AS USER_ID,
            NVL(BRD_TITLE, '') AS BRD_TITLE,
            NVL(BRD_CONTENT, '') AS BRD_CONTENT,
            NVL(BRD_READ_CNT, 0) AS BRD_READ_CNT,
            NVL(BRD_SECRET, '') AS BRD_SECRET,
            NVL(TO_CHAR(REG_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') AS REG_DATE,
            NVL(TO_CHAR(MOD_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') AS MOD_DATE,
            NVL(TO_CHAR(DEL_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') AS DEL_DATE,
            NVL(CATEGORY, 0) AS CATEGORY,
            (SELECT USER_PROFILE FROM EDU_USER WHERE EDU_BOARD.USER_ID = EDU_USER.USER_ID) USER_PROFILE,
            (SELECT USER_NAME FROM 
                              (SELECT USER_ID, USER_NAME
                           FROM EDU_USER
                               
                        UNION ALL
                               
                         SELECT USER_ID, USER_NAME
                           FROM EDU_TEACHER)
                          WHERE USER_ID = EDU_BOARD.USER_ID
                               ) USER_NAME
          FROM EDU_BOARD
         WHERE BRD_SEQ = #{brdSeq}
           AND   DEL_DATE IS NULL
    </select>
    
    <!-- 첨부파일 조회 -->
   <select id="freeBoardFileSelect" parameterType="long"  resultMap="boardFileResultMap">
      SELECT   BRD_SEQ,
             FILE_SEQ,
             NVL(FILE_ORG_NAME, '') FILE_ORG_NAME,
             NVL(FILE_NAME, '') FILE_NAME,
             NVL(FILE_EXT, '') FILE_EXT,
             NVL(FILE_SIZE, 0) FILE_SIZE,
             NVL(TO_CHAR(REG_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') REG_DATE
        FROM  EDU_BOARD_FILE
       WHERE  BRD_SEQ = #{brdSeq}
         AND   FILE_SEQ = 1
   </select>
    
    <!-- 게시글 조회수 증가 -->
   <update id="freeBoardReadCntPlus" parameterType="long">
      UPDATE EDU_BOARD
         SET BRD_READ_CNT = BRD_READ_CNT + 1
       WHERE BRD_SEQ = #{brdSeq}
   </update> 
    
    <!-- 게시물 삭제-->
   <delete id="freeBoardDelete" parameterType="long">
      UPDATE EDU_BOARD
         SET DEL_DATE = SYSDATE
        WHERE BRD_SEQ = #{brdSeq}
   </delete>
   
   <!-- free(자유게시판) 게시물 삭제 -->
   <delete id="freeRealBoardDelete" parameterType="long">
      DELETE FROM EDU_BOARD
       WHERE BRD_SEQ = #{brdSeq}
   </delete>
   
   <!-- 게시물 첨부파일 삭제-->
   <delete id="freeBoardFileDelete" parameterType="long">
      DELETE FROM EDU_BOARD_FILE
        WHERE BRD_SEQ = #{brdSeq}
   </delete>
   
   <!-- 게시물 수정 -->
   <update id="freeBoardUpdate" parameterType="com.sist.web.model.Board">
      UPDATE EDU_BOARD
            SET BRD_TITLE = #{brdTitle},
              BRD_CONTENT = #{brdContent},
              CATEGORY = #{category},
              MOD_DATE = SYSDATE
        WHERE BRD_SEQ = #{brdSeq}
   </update>
   
    <!-- 좋아요 조회 -->
   <select id="freeSelectLike" parameterType="map" resultMap="boardLikeResultMap">
      SELECT *
      FROM   EDU_BOARD_RECOM      
      WHERE USER_ID = #{userId}
        AND BRD_SEQ = #{brdSeq}
   </select>
    
    <!-- 좋아요 증가 -->
   <insert id="freeInsertLike" parameterType="map">
      INSERT INTO EDU_BOARD_RECOM (
          USER_ID,
          BRD_SEQ
      ) VALUES (
          #{userId},
          #{brdSeq}
      )
   </insert>
    
    <!-- 좋아요 감소 -->
   <delete id="freeDeleteLike" parameterType="map">
      DELETE FROM EDU_BOARD_RECOM
       WHERE USER_ID = #{userId}
         AND BRD_SEQ = #{brdSeq}
   </delete>
    
    <!-- 좋아요 수 조회 -->
   <select id="freeSelectLikeCount" parameterType="map" resultType="int">
           SELECT COUNT(*) 
           FROM EDU_BOARD_RECOM 
           WHERE BRD_SEQ = #{brdSeq}
   </select>
    
    <!-- 북마크 조회 -->
   <select id="freeSelectMark" parameterType="map" resultMap="boardMarkResultMap">
      SELECT *
      FROM   EDU_BOARD_BOOKMARK      
      WHERE USER_ID = #{userId}
        AND BRD_SEQ = #{brdSeq}
   </select>
    
    <!-- 북마크 증가 -->
   <insert id="freeInsertMark" parameterType="map">
      INSERT INTO EDU_BOARD_BOOKMARK (
          USER_ID,
          BRD_SEQ
      ) VALUES (
          #{userId},
          #{brdSeq}
      )
   </insert>
    
    <!-- 북마크 감소 -->
   <delete id="freeDeleteMark" parameterType="map">
      DELETE FROM EDU_BOARD_BOOKMARK
       WHERE USER_ID = #{userId}
         AND BRD_SEQ = #{brdSeq}
   </delete>



   
<!-- #############################################자유게시판(끝)############################################ -->   
         <!-- ################################################################################ -->
                  <!-- ###################################################### -->   


</mapper>